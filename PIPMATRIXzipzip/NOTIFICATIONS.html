<!DOCTYPE html>
<html lang="en" x-data="notificationsData()"
      @init="init()"
      :class="{ 'dark': darkMode }"
      class="dark bg-gray-900">
<head>
    <meta charset="UTF-8">
    <title>Notifications - PipMatrix</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://remedyalgotradescript.sbs/storage/app/public/photos/Px9MifdF6k4uRiyRSGBX6qi4kKWtbhpkYNQrAouw.png" rel="icon" type="image/x-icon" />
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Enable dark mode class strategy -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                    },
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
        if (!localStorage.getItem('theme')) {
            localStorage.setItem('theme', 'dark');
            document.documentElement.classList.add('dark');
        }
    </script>
<script src="static/js/api.js"></script>
<script>
function notificationsData() {
  return {
    darkMode: localStorage.theme === 'dark' || !localStorage.theme,
    userData: null,
    notifications: [],
    loading: true,
    
    async init() {
      await this.loadUserData();
      await this.loadNotifications();
    },
    
    async loadNotifications() {
      try {
        const response = await api.request('/notifications');
        if (response.success && response.notifications) {
          this.notifications = response.notifications;
        }
      } catch (error) {
        console.error('Error loading notifications:', error);
        this.notifications = [];
      }
    },
    
    async loadUserData() {
      try {
        const authCheck = await api.auth.check();
        if (!authCheck.authenticated) {
          window.location.href = 'LOGIN.html';
          return;
        }
        
        const profile = await api.user.getProfile();
        
        if (profile.success) {
          this.userData = profile.user || profile.data;
        }
        this.loading = false;
      } catch (error) {
        console.error('Error loading user data:', error);
        this.loading = false;
      }
    },
    
    get userFullName() {
      return this.userData?.full_name || this.userData?.username || 'User';
    },
    
    get avatarInitials() {
      const name = this.userFullName || 'U';
      return name.charAt(0).toUpperCase();
    },
    
    async handleLogout() {
      try {
        await api.auth.logout();
        window.location.href = 'LOGIN.html';
      } catch (error) {
        console.error('Logout failed:', error);
      }
    }
  };
}
</script>
</head>
<body :class="{ 'dark': darkMode }"
      class="dark text-gray-100 bg-gray-900" x-cloak>

<!-- Professional Trading Navbar -->
<nav x-data="{ open: false, darkMode: localStorage.theme === 'dark' || !localStorage.theme, dropdownOpen: false }"
     class="bg-white/98 dark:bg-gray-900/98 backdrop-blur-xl border-b border-gray-200/80 dark:border-gray-700/80 sticky top-0 z-50 shadow-sm dark:shadow-gray-900/20" x-cloak>

  <!-- Main Navigation Container -->
  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">

      <!-- Left Section: Logo -->
      <div class="flex items-center space-x-4">
        <a href="DASHBOARD.html" class="flex items-center space-x-3 group">
          <img src="images/LOGO.jpeg" class="h-12 sm:h-16 w-auto" alt="Logo" />
          <div class="hidden sm:block">
            <span class="text-lg font-bold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
             Pip Matrix
            </span>
            <div class="text-xs text-gray-500 dark:text-gray-400 font-medium">
              Professional Trading
            </div>
          </div>
        </a>
      </div>

      <!-- Right Section: User Profile -->
      <div class="flex items-center space-x-2">
        <div class="relative" x-data="{ dropdownOpen: false }">
          <button @click="dropdownOpen = !dropdownOpen"
                  class="flex items-center space-x-3 px-2 py-2 text-sm rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none">
            <div class="flex items-center space-x-2">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white text-sm font-medium" x-text="avatarInitials">
                M
              </div>
              <div class="hidden sm:block text-left">
                <div class="text-sm font-medium text-gray-900 dark:text-white truncate max-w-[120px]" x-text="userFullName">
                  User
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  Trading Account
                </div>
              </div>
            </div>
            <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400" :class="dropdownOpen ? 'rotate-180' : ''"></i>
          </button>

          <div x-show="dropdownOpen" @click.away="dropdownOpen = false"
               x-transition:enter="transition ease-out duration-200"
               x-transition:enter-start="opacity-0 scale-95"
               x-transition:enter-end="opacity-100 scale-100"
               class="absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20" x-cloak>

            <!-- User Info Header -->
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
              <div class="flex items-center space-x-3">
                <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white text-lg font-medium" x-text="avatarInitials">
                  M
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-900 dark:text-white" x-text="userFullName">
                    User
                  </div>
                </div>
              </div>
            </div>

            <!-- Menu Items -->
            <div class="p-2">
              <a href="DASHBOARD.html" class="flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md">
                <i data-lucide="home" class="w-4 h-4 mr-3"></i>
                Dashboard
              </a>
              <a href="PROFILE.html" class="flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md">
                <i data-lucide="user" class="w-4 h-4 mr-3"></i>
                Profile Settings
              </a>
              <button @click="handleLogout()" class="w-full text-left flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md">
                <i data-lucide="log-out" class="w-4 h-4 mr-3"></i>
                Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="max-w-4xl mx-auto px-4 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Notifications</h1>
    <p class="text-gray-600 dark:text-gray-400">Stay updated with all your account activity and trading updates</p>
  </div>

  <!-- Notifications List -->
  <div class="space-y-3">
    <!-- Loading State -->
    <template x-if="loading">
      <div class="flex justify-center py-12">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
          <p class="text-gray-600 dark:text-gray-400">Loading notifications...</p>
        </div>
      </div>
    </template>

    <!-- Empty State -->
    <template x-if="!loading && (!notifications || notifications.length === 0)">
      <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-12 text-center">
        <i data-lucide="bell-off" class="w-16 h-16 mx-auto text-gray-400 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Notifications</h3>
        <p class="text-gray-600 dark:text-gray-400">You're all caught up! Check back later for updates on your account and trades.</p>
      </div>
    </template>

    <!-- Notifications Items -->
    <template x-if="!loading && notifications && notifications.length > 0">
      <template x-for="notification in notifications" :key="notification.id">
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md dark:hover:shadow-gray-900/50 transition-shadow"
             :class="notification.read ? '' : 'border-blue-300 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/10'">
          <div class="flex items-start">
            <!-- Icon -->
            <div class="flex-shrink-0 mt-0.5">
              <span class="flex h-10 w-10 rounded-full items-center justify-center" 
                    :class="notification.type === 'success' ? 'bg-green-100 text-green-600 dark:bg-green-900/20 dark:text-green-500' : 'bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-500'">
                <i :data-lucide="notification.type === 'success' ? 'check-circle' : 'info'" class="w-5 h-5"></i>
              </span>
            </div>

            <!-- Content -->
            <div class="ml-4 w-0 flex-1">
              <p class="text-sm font-semibold text-gray-900 dark:text-white" x-text="notification.title"></p>
              <p class="mt-1 text-sm text-gray-600 dark:text-gray-400" x-text="notification.message"></p>
              <p class="mt-2 text-xs text-gray-500 dark:text-gray-500" x-text="notification.time_ago || 'Just now'"></p>
            </div>

            <!-- Badge -->
            <template x-if="!notification.read">
              <div class="flex-shrink-0 ml-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400">
                  New
                </span>
              </div>
            </template>
          </div>
        </div>
      </template>
    </template>
  </div>
</div>

<!-- Footer -->
<footer class="bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700 mt-12">
  <div class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
      <div>
        <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 uppercase">About</h3>
        <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">About Us</a></li>
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Blog</a></li>
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Careers</a></li>
        </ul>
      </div>
      <div>
        <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 uppercase">Support</h3>
        <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Help Center</a></li>
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Contact Us</a></li>
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Status</a></li>
        </ul>
      </div>
      <div>
        <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 uppercase">Legal</h3>
        <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Privacy Policy</a></li>
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Terms of Service</a></li>
          <li><a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Cookie Policy</a></li>
        </ul>
      </div>
    </div>
    <div class="pt-8 border-t border-gray-200 dark:border-gray-700">
      <p class="text-center text-sm text-gray-600 dark:text-gray-400">
        &copy; 2024 PipMatrix. All rights reserved.
      </p>
    </div>
  </div>
</footer>

<script src="https://unpkg.com/lucide@latest"></script>
</body>
</html>
